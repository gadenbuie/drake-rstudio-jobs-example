---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  eval = FALSE,
  collapse = TRUE,
  comment = "##"
)
```

Could we try something even simpler? What the plan and all dependencies are contained in single file [make.R](make.R)?

Note that `make.R` includes logic to build up to and including the regression targets if they are out of date, otherwise to build everything.

## Standard Setup

Standard `make()` in fresh session/cache.

```{r}
if (dir.exists(".drake")) unlink(".drake", recursive = TRUE)
callr::rscript("make.R", show = TRUE)
callr::rscript("make.R", show = TRUE)
```

### Step 1

```{r eval=TRUE, echo=FALSE, results='asis'}
log_file <- function(key, step = 1) {
  cat("\n\n![](", key, ".png)", sep = "")
  
  cat("\n\n`console.log`\n\n```\n")
  cat(readLines(paste0(key, "-step", step, "-console.log")), sep = "\n")
  cat("\n```\n")
  
  cat("\n\n`cache.log`\n\n```\n")
  cat(readLines(paste0(key, "-step", step, "-cache.log")), sep = "\n")
  cat("\n```\n")
  
}
```

```{r eval=TRUE, echo=FALSE, results='asis'}
log_file("BMBmeBFtLK", 1)
```

### Step 2

```{r eval=TRUE, echo=FALSE, results='asis'}
log_file("1TQxNd1Z2Q", 2)
```

## RStudio Job Launcher

What do the results look like if you run the following with a fresh session and cache?

```{r}
if (dir.exists(".drake")) unlink(".drake", recursive = TRUE)
# Step 1
rstudioapi::jobRunScript("make.R", workingDir = getwd())

# Step 2
callr::rscript("make.R", show = TRUE)
```

### Step 1

```{r eval=TRUE, echo=FALSE, results='asis'}
log_file("fxF3uoG9oC", 1)
```

### Step 2

```{r eval=TRUE, echo=FALSE, results='asis'}
log_file("YpqJ9l9iJ9", 2)
```


## Results

Both of the above work as expected --- as long as `make.R` doesn't source any external functions, everything exists in the same environment!
